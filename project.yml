---
apiVersion: v1
kind: Template
metadata:
  name: redis-ruby-template
  annotations:
    description: "Description"
    iconClass: "icon-redis"
    tags: "redis,ruby"
objects:
  - apiVersion: v1
    kind: ImageStream
    metadata:
      creationTimestamp:
      generation: 1
      labels:
        app: redisharu
      name: redisharu
  - kind: BuildConfig
    apiVersion: v1
    metadata:
      name: redis-build
      creationTimestamp:
      labels:
        name: redis-build
    spec:
      source:
        type: Git
        git:
          uri: git://github.com/ahharu/openshift-demo
          ref: master
        contextDir: projects/redis
      strategy:
        type: Docker
        dockerStrategy:
      triggers:
        - github:
            secretReference:
              name: redis-build-trigger
          type: GitHub
      output:
        to:
          kind: ImageStreamTag
          name: redisharu:latest
      resources: {}
  - apiVersion: v1
    data:
      WebHookSecretKey: MWUyNzY0ZDAxYjQ2ODQxOQ==
    kind: Secret
    metadata:
      creationTimestamp:
      name: redis-build-trigger
    type: Opaque
  - apiVersion: v1
    kind: ImageStream
    metadata:
      creationTimestamp:
      generation: 1
      labels:
        app: rubyharu
      name: rubyharu
  - kind: BuildConfig
    apiVersion: v1
    metadata:
      name: ruby-build
      creationTimestamp:
      labels:
        name: ruby-build
    spec:
      source:
        type: Git
        git:
          uri: git://github.com/ahharu/openshift-demo
          ref: master
        contextDir: projects/ruby-app
      strategy:
        type: Docker
        dockerStrategy:
      triggers:
        - github:
            secretReference:
              name: ruby-build-trigger
          type: GitHub
      output:
        to:
          kind: ImageStreamTag
          name: rubyharu:latest
      resources: {}
  - apiVersion: v1
    data:
      WebHookSecretKey: MWUyNzY0ZDAxYjQ2ODQxOQ==
    kind: Secret
    metadata:
      creationTimestamp:
      name: ruby-build-trigger
    type: Opaque
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      name: rubyharu
      labels:
        deploymentConfig: rubyharu
        application: rubyharu
    spec:
      replicas: 2
      selector:
        deploymentConfig: rubyharu
      strategy:
        activeDeadlineSeconds: 21600
        resources: {}
        rollingParams:
          intervalSeconds: 1
          maxSurge: 25%
          maxUnavailable: 25%
          timeoutSeconds: 600
          updatePeriodSeconds: 1
        type: Rolling
      template:
        metadata:
          labels:
            deploymentConfig: rubyharu
            application: rubyharu
          name: rubyharu
        spec:
          containers:
            - name: rubyharu
              image: rubyharu
              imagePullPolicy: Always
              env:
                - name: REDIS_HOST
                  value: '127.0.0.1'
                - name: REDIS_PORT
                  value: '6379'
              ports:
                - name: rubyharu-http
                  containerPort: 4567
                  protocol: TCP
              resources: {}
              terminationMessagePath: "/dev/termination-log"
              securityContext:
                capabilities: {}
                privileged: false
          restartPolicy: Always
          dnsPolicy: ClusterFirst
      triggers:
      - type: ImageChange
        imageChangeParams:
          automatic: true
          containerNames:
          - rubyharu
          from:
            kind: ImageStreamTag
            name: rubyharu:latest
      - type: ConfigChange


